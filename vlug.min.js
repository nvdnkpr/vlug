(function(){var e=this,t=e.Vlug;Vlug={},Vlug.noConflict=function(){e.Vlug=t},Vlug.initialContext=e,function(){var e=function(e,t){var n=e||{},r=t||{},i;for(i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n},t=function(e,t){var n=e,r=t,i;for(i in r)r.hasOwnProperty(i)&&typeof n[i]=="undefined"&&(n[i]=r[i]);return n},n=function(){var e=Array.prototype.forEach;return e?function(t,n,r){e.call(t,n,r)}:function(e,t,n){var r,i=e.length;for(r=0;r<i;++r)t.call(n||this,e[r],r,e);return e}}(),r=function(){var e=Array.isArray;return e?e:function(e){return toString.call(e)==="[object Array]"}}(),i=function(e){return Vlug.utils.Array.isArray(e)?e:typeof e=="undefined"?[]:[e]},s=function(e,t,r){return n(i(e),t,r)},o=function(){var e=console.time,t=console.timeEnd,n;return e?(e=function(e){console.time.call(console,e)},t=function(e){console.timeEnd.call(console,e)}):(n={},e=function(e){n[e]=new Date},t=function(e){var t=(new Date).getTime()-n[e].getTime();delete n.id,console.log("%s : %ims",e,t)}),{time:e,timeEnd:t}}(),u=function(){return typeof performance!="undefined"?function(){return performance.now()}:function(){return(new Date).getTime()}}();e(Vlug,{utils:{apply:e,mix:t,Array:{forEach:n,each:s,isArray:r,from:i},console:o,timeStamp:u},mixins:{},abstractFn:function(){throw new Error("abstractFn must be implemented")},emptyFn:function(){}})}(),Vlug.mixins.TimeTracker={stampStart:function(e){this._initTimes(),this.log&&Vlug.utils.console.time(e),this._timeStamps[e]=Vlug.utils.timeStamp()},_initTimes:function(){this._timeStamps||(this._timeStamps={},this._totalTimes={})},stampEnd:function(e){var t=this._timeStamps[e],n=Vlug.utils.timeStamp()-t;this._trackTime(e,n),this.log&&Vlug.utils.console.timeEnd(e)},_trackTime:function(e,t){this._totalTimes[e]||(this._totalTimes[e]={iterationsRun:0,totalTime:0}),this._totalTimes[e].iterationsRun+=this._getIterationsToAdd(e),this._totalTimes[e].totalTime+=t},_getIterationsToAdd:Vlug.abstractFn,getReport:function(){return this._buildReportObject()},_buildReportObject:function(){var e,t={};for(e in this._totalTimes)this._totalTimes.hasOwnProperty(e)&&(t[e]=Vlug.utils.apply({},this._totalTimes[e]),t[e].average=t[e].totalTime/t[e].iterationsRun);return t}},Vlug.Runner=function(e){this.init(e)},Vlug.Runner.prototype={iterations:10,log:!0,init:function(e){Vlug.utils.apply(this,e)},run:function(){Vlug.utils.Array.forEach(this.functions,function(e,t){var n=e.name,r;n?r=e.fn||e:(n="index:"+t,r=e),this._runFunction(r,n)},this)},_runFunction:function(e,t){this.stampStart(t),this._runFunctionForIterations(e),this.stampEnd(t)},_runFunctionForIterations:function(e){var t=this.iterations,n=0;for(;n<t;++n)e()},setIterations:function(e){this.iterations=e},setLog:function(e){this.log=e},_getIterationsToAdd:function(){return this.iterations}},Vlug.utils.mix(Vlug.Runner.prototype,Vlug.mixins.TimeTracker),Vlug.Interceptor=function(e){this.init(e)},Vlug.Interceptor.prototype={init:function(e){Vlug.utils.apply(this,Vlug.utils.apply(e,{log:!0})),this._restoreFns=[],this._initLogs(),this._initTimeLogs()},_initLogs:function(){Vlug.utils.Array.each(this.logs,function(e){this._intercept(this._createLogInterceptConfig(e))},this)},_createLogInterceptConfig:function(e){var t=Vlug.utils.apply({},e);return t.before=this._logToFn(t.before),t.after=this._logToFn(t.after),t},_logToFn:function(e){return typeof e=="function"?function(){console.log(e.apply(this,arguments))}:typeof e!="undefined"?function(){console.log(e)}:Vlug.emptyFn},_initTimeLogs:function(){Vlug.utils.Array.each(this.times,function(e,t,n){var r=this._createTimeConfig(e,this._hasDuplicateName(e)?e.fnName+t:e.fnName);this._intercept(r)},this)},_hasDuplicateName:function(e){var t=0,n=this.times,r=n.length,i=e.fnName,s;for(;t<r;++t){s=n[t];if(s!==e&&s.fnName===i)return!0}},_createTimeConfig:function(e,t){var n=this;return Vlug.utils.apply(e,{before:function(){n.stampStart(t)},after:function(){n.stampEnd(t)}})},_intercept:function(e){var t=e.obj,n=e.fnName,r=t[n],i=e.before,s=e.after,o=e.logResult;t[n]=function(){var e;return i.apply(this,arguments),e=r.apply(this,arguments),o&&console.log(e),s.apply(this,arguments),e},this._restoreFns.push(function(){t[n]=r})},restore:function(){Vlug.utils.Array.forEach(this._restoreFns.reverse(),function(e){e()},this)},_getIterationsToAdd:function(e){return 1}},Vlug.utils.mix(Vlug.Interceptor.prototype,Vlug.mixins.TimeTracker),typeof module!="undefined"&&typeof module.exports!="undefined"&&(module.exports=Vlug)})()